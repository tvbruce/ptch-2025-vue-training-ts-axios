<template>
    <div class="advanced-typescript">
        <div class="section-intro">
            <h2>TypeScript é€²éšæ¦‚å¿µ</h2>
            <p class="section-description">
                æŒæ¡ TypeScript çš„é€²éšç‰¹æ€§ï¼Œæå‡ç¨‹å¼ç¢¼çš„å‹åˆ¥å®‰å…¨æ€§å’Œå¯ç¶­è­·æ€§ã€‚
                åŒ…æ‹¬æ³›å‹è¨­è¨ˆã€æ¢ä»¶å‹åˆ¥ã€å¯¦ç”¨å‹åˆ¥å’Œè£é£¾å™¨ç­‰ä¼æ¥­ç´šé–‹ç™¼å¿…å‚™æŠ€èƒ½ã€‚
            </p>
        </div>

        <!-- é€²éšå‹åˆ¥ç³»çµ± -->
        <div class="content-section">
            <h3>ğŸ”® é€²éšå‹åˆ¥ç³»çµ±</h3>

            <div class="type-category">
                <h4>è¯åˆå‹åˆ¥èˆ‡äº¤é›†å‹åˆ¥</h4>
                <p>ç†è§£è¤‡é›œå‹åˆ¥çµ„åˆçš„å¨åŠ›</p>

                <CodeBlock title="è¯åˆèˆ‡äº¤é›†å‹åˆ¥ç¯„ä¾‹" :code="unionIntersectionCode" language="typescript"
                    explanation="å±•ç¤ºå¦‚ä½•ä½¿ç”¨è¯åˆå‹åˆ¥å’Œäº¤é›†å‹åˆ¥å»ºç«‹éˆæ´»çš„å‹åˆ¥ç³»çµ±" />
            </div>

            <div class="type-category">
                <h4>æ˜ å°„å‹åˆ¥ (Mapped Types)</h4>
                <p>å‹•æ…‹å»ºç«‹å‹åˆ¥çš„å¼·å¤§å·¥å…·</p>

                <CodeBlock title="æ˜ å°„å‹åˆ¥å¯¦ä½œ" :code="mappedTypesCode" language="typescript" explanation="ä½¿ç”¨æ˜ å°„å‹åˆ¥å»ºç«‹å‹•æ…‹çš„å‹åˆ¥è½‰æ›" />
            </div>

            <div class="type-category">
                <h4>ç´¢å¼•å­˜å–å‹åˆ¥</h4>
                <p>å¾ç¾æœ‰å‹åˆ¥ä¸­æå–å­å‹åˆ¥</p>

                <CodeBlock title="ç´¢å¼•å­˜å–å‹åˆ¥" :code="indexAccessCode" language="typescript"
                    explanation="é€šéç´¢å¼•å­˜å–å¾è¤‡é›œå‹åˆ¥ä¸­æå–æ‰€éœ€çš„å­å‹åˆ¥" />
            </div>
        </div>

        <!-- æ³›å‹èˆ‡æ¢ä»¶å‹åˆ¥ -->
        <div class="content-section">
            <h3>âš¡ æ³›å‹èˆ‡æ¢ä»¶å‹åˆ¥</h3>

            <div class="generic-section">
                <h4>é€²éšæ³›å‹è¨­è¨ˆ</h4>
                <p>å»ºç«‹å¯é‡ç”¨ä¸”å‹åˆ¥å®‰å…¨çš„æ³›å‹å‡½æ•¸å’Œé¡åˆ¥</p>

                <CodeBlock title="æ³›å‹ç´„æŸèˆ‡æ¢ä»¶" :code="advancedGenericsCode" language="typescript"
                    explanation="ä½¿ç”¨æ³›å‹ç´„æŸå’Œæ¢ä»¶å»ºç«‹éˆæ´»çš„ API" />
            </div>

            <div class="conditional-section">
                <h4>æ¢ä»¶å‹åˆ¥</h4>
                <p>æ ¹æ“šå‹åˆ¥æ¢ä»¶å‹•æ…‹æ±ºå®šå‹åˆ¥</p>

                <CodeBlock title="æ¢ä»¶å‹åˆ¥å¯¦ä½œ" :code="conditionalTypesCode" language="typescript"
                    explanation="æ¢ä»¶å‹åˆ¥è®“æˆ‘å€‘å¯ä»¥æ ¹æ“šè¼¸å…¥å‹åˆ¥å‹•æ…‹æ±ºå®šè¼¸å‡ºå‹åˆ¥" />
            </div>

            <div class="utility-section">
                <h4>å¯¦ç”¨å‹åˆ¥ (Utility Types)</h4>
                <p>TypeScript å…§å»ºçš„å¯¦ç”¨å‹åˆ¥å·¥å…·</p>

                <CodeBlock title="å¯¦ç”¨å‹åˆ¥æ‡‰ç”¨" :code="utilityTypesCode" language="typescript"
                    explanation="å­¸ç¿’ä½¿ç”¨ TypeScript æä¾›çš„å¯¦ç”¨å‹åˆ¥ä¾†ç°¡åŒ–é–‹ç™¼" />
            </div>
        </div>

        <!-- è£é£¾å™¨ä½¿ç”¨ -->
        <div class="content-section">
            <h3>ğŸ­ è£é£¾å™¨ä½¿ç”¨</h3>

            <div class="decorator-intro">
                <p>è£é£¾å™¨æ˜¯ä¸€ç¨®ç‰¹æ®Šçš„å®£å‘Šï¼Œå¯ä»¥é™„åŠ åˆ°é¡åˆ¥ã€æ–¹æ³•ã€å±¬æ€§æˆ–åƒæ•¸ä¸Šï¼Œç”¨æ–¼ä¿®æ”¹å®ƒå€‘çš„è¡Œç‚ºã€‚</p>
            </div>

            <div class="decorator-category">
                <h4>é¡åˆ¥è£é£¾å™¨</h4>
                <p>ä¿®æ”¹é¡åˆ¥çš„è¡Œç‚ºå’Œå±¬æ€§</p>

                <CodeBlock title="é¡åˆ¥è£é£¾å™¨å¯¦ä½œ" :code="classDecoratorCode" language="typescript"
                    explanation="é¡åˆ¥è£é£¾å™¨å¯ä»¥ç”¨ä¾†æ·»åŠ metadataã€ä¿®æ”¹æ§‹é€ å‡½æ•¸ç­‰" />

                <CodeComparison
                    title="é¡åˆ¥è£é£¾å™¨ç·¨è­¯å°æ¯”"
                    beforeTitle="TypeScript è£é£¾å™¨èªæ³•"
                    afterTitle="ç·¨è­¯å¾Œçš„ JavaScript"
                    :beforeCode="classDecoratorOriginal"
                    :afterCode="classDecoratorCompiled"
                    language="typescript"
                    afterLanguage="javascript"
                    explanation="TypeScript è£é£¾å™¨æœƒè¢«ç·¨è­¯æˆå‡½æ•¸èª¿ç”¨çš„å½¢å¼ï¼Œä¸¦ä½¿ç”¨ Reflect.decorate é€²è¡Œå…ƒæ•¸æ“šè™•ç†"
                    :highlights="[
                        'è£é£¾å™¨ @Component è®Šæˆäº† Component() å‡½æ•¸èª¿ç”¨',
                        'é¡åˆ¥å®šç¾©è¢«åŒ…è£åœ¨ __decorate å‡½æ•¸ä¸­',
                        'è£é£¾å™¨æŒ‰ç…§è²æ˜é †åºåŸ·è¡Œ',
                        'ç·¨è­¯å¾Œçš„ä»£ç¢¼åŒ…å«äº†åå°„å…ƒæ•¸æ“š'
                    ]"
                />
            </div>

            <div class="decorator-category">
                <h4>æ–¹æ³•è£é£¾å™¨</h4>
                <p>å¢å¼·æ–¹æ³•çš„åŠŸèƒ½</p>

                <CodeBlock title="æ–¹æ³•è£é£¾å™¨ç¯„ä¾‹" :code="methodDecoratorCode" language="typescript"
                    explanation="æ–¹æ³•è£é£¾å™¨å¸¸ç”¨æ–¼æ—¥èªŒè¨˜éŒ„ã€æ•ˆèƒ½ç›£æ§ã€æ¬Šé™æª¢æŸ¥ç­‰" />

                <CodeComparison
                    title="æ–¹æ³•è£é£¾å™¨ç·¨è­¯å°æ¯”"
                    beforeTitle="TypeScript æ–¹æ³•è£é£¾å™¨"
                    afterTitle="ç·¨è­¯å¾Œçš„ JavaScript"
                    :beforeCode="methodDecoratorOriginal"
                    :afterCode="methodDecoratorCompiled"
                    language="typescript"
                    afterLanguage="javascript"
                    explanation="æ–¹æ³•è£é£¾å™¨æœƒä¿®æ”¹å±¬æ€§æè¿°ç¬¦ï¼Œä¸¦åœ¨ç·¨è­¯æ™‚åŒ…è£åŸå§‹æ–¹æ³•"
                    :highlights="[
                        'æ–¹æ³•è£é£¾å™¨é€é Object.defineProperty ä¿®æ”¹æ–¹æ³•',
                        'åŸå§‹æ–¹æ³•è¢«ä¿å­˜ä¸¦åŒ…è£åœ¨æ–°çš„å‡½æ•¸ä¸­',
                        'è£é£¾å™¨é‚è¼¯åœ¨æ–¹æ³•èª¿ç”¨å‰å¾ŒåŸ·è¡Œ',
                        'ä¿æŒäº†åŸå§‹æ–¹æ³•çš„ this ç¶å®š'
                    ]"
                />
            </div>

            <div class="decorator-category">
                <h4>å±¬æ€§è£é£¾å™¨</h4>
                <p>æ§åˆ¶å±¬æ€§çš„è¡Œç‚º</p>

                <CodeBlock title="å±¬æ€§è£é£¾å™¨æ‡‰ç”¨" :code="propertyDecoratorCode" language="typescript"
                    explanation="å±¬æ€§è£é£¾å™¨å¯ä»¥ç”¨æ–¼é©—è­‰ã€æ ¼å¼åŒ–ã€åºåˆ—åŒ–ç­‰" />

                <CodeComparison
                    title="å±¬æ€§è£é£¾å™¨ç·¨è­¯å°æ¯”"
                    beforeTitle="TypeScript å±¬æ€§è£é£¾å™¨"
                    afterTitle="ç·¨è­¯å¾Œçš„ JavaScript"
                    :beforeCode="propertyDecoratorOriginal"
                    :afterCode="propertyDecoratorCompiled"
                    language="typescript"
                    afterLanguage="javascript"
                    explanation="å±¬æ€§è£é£¾å™¨æœƒé‡æ–°å®šç¾©å±¬æ€§çš„ getter å’Œ setterï¼Œå¯¦ç¾å±¬æ€§æ””æˆª"
                    :highlights="[
                        'å±¬æ€§è£é£¾å™¨é€é Object.defineProperty é‡æ–°å®šç¾©å±¬æ€§',
                        'åŸå§‹å±¬æ€§å€¼è¢«å­˜å„²åœ¨é–‰åŒ…ä¸­',
                        'getter å’Œ setter å‡½æ•¸åŒ…å«äº†è£é£¾å™¨é‚è¼¯',
                        'å±¬æ€§çš„ enumerable å’Œ configurable ç‰¹æ€§è¢«ä¿ç•™'
                    ]"
                />
            </div>
        </div>

        <!-- å¯¦æˆ°æ‡‰ç”¨ -->
        <div class="content-section">
            <h3>ğŸ¯ å¯¦æˆ°æ‡‰ç”¨ï¼šå‹åˆ¥å®‰å…¨çš„ API ç³»çµ±</h3>

            <div class="practice-description">
                <p>çµåˆé€²éšå‹åˆ¥æ¦‚å¿µï¼Œå»ºç«‹ä¸€å€‹å®Œæ•´çš„å‹åˆ¥å®‰å…¨ API ç³»çµ±</p>
            </div>

            <CodeBlock title="ä¼æ¥­ç´šå‹åˆ¥å®‰å…¨ API è¨­è¨ˆ" :code="apiSystemCode" language="typescript"
                explanation="å±•ç¤ºå¦‚ä½•çµåˆæ³›å‹ã€æ¢ä»¶å‹åˆ¥å’Œå¯¦ç”¨å‹åˆ¥å»ºç«‹ä¼æ¥­ç´š API ç³»çµ±" />
        </div>

        <!-- æ•ˆèƒ½èˆ‡æœ€ä½³å¯¦è¸ -->
        <div class="content-section">
            <h3>ğŸš€ æ•ˆèƒ½èˆ‡æœ€ä½³å¯¦è¸</h3>

            <div class="best-practices">
                <div class="practice-item">
                    <h4>å‹åˆ¥æ•ˆèƒ½å„ªåŒ–</h4>
                    <ul>
                        <li>é¿å…éåº¦è¤‡é›œçš„æ¢ä»¶å‹åˆ¥</li>
                        <li>åˆç†ä½¿ç”¨æ³›å‹ç´„æŸ</li>
                        <li>é¸æ“‡é©ç•¶çš„å‹åˆ¥æª¢æŸ¥ç­–ç•¥</li>
                    </ul>
                </div>

                <div class="practice-item">
                    <h4>å¯ç¶­è­·æ€§åŸå‰‡</h4>
                    <ul>
                        <li>ä¿æŒå‹åˆ¥å®šç¾©ç°¡æ½”æ˜ç¢º</li>
                        <li>é©ç•¶ä½¿ç”¨å‹åˆ¥åˆ¥å</li>
                        <li>æ–‡æª”åŒ–è¤‡é›œå‹åˆ¥</li>
                    </ul>
                </div>

                <div class="practice-item">
                    <h4>åœ˜éšŠé–‹ç™¼è¦ç¯„</h4>
                    <ul>
                        <li>çµ±ä¸€å‹åˆ¥å‘½åè¦ç¯„</li>
                        <li>å»ºç«‹å‹åˆ¥åº«å’Œå…±ç”¨æ¨¡çµ„</li>
                        <li>è¨­å®šé©ç•¶çš„ TSConfig é¸é …</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import CodeBlock from '@/components/common/CodeBlock.vue'
import CodeComparison from '@/components/common/CodeComparison.vue'

interface Props {
    section?: {
        title: string
        description?: string
    }
}

defineProps<Props>()

defineEmits<{
    complete: []
}>()

// è¯åˆèˆ‡äº¤é›†å‹åˆ¥ç¯„ä¾‹
const unionIntersectionCode = ref(`// è¯åˆå‹åˆ¥ - è¡¨ç¤ºå¤šç¨®å¯èƒ½çš„å‹åˆ¥ä¹‹ä¸€
type Status = 'loading' | 'success' | 'error'
type ID = string | number

// äº¤é›†å‹åˆ¥ - çµ„åˆå¤šå€‹å‹åˆ¥çš„æ‰€æœ‰å±¬æ€§
interface User {
    id: ID
    name: string
}

interface Timestamps {
    createdAt: Date
    updatedAt: Date
}

// äº¤é›†å‹åˆ¥ï¼šUser & Timestamps æ“æœ‰å…©è€…çš„æ‰€æœ‰å±¬æ€§
type UserWithTimestamps = User & Timestamps

// å¯¦éš›æ‡‰ç”¨ï¼šAPI éŸ¿æ‡‰å‹åˆ¥
type ApiResponse<T> = {
    data: T
    status: Status
    message: string
} & Timestamps

// ä½¿ç”¨ç¯„ä¾‹
const userResponse: ApiResponse<User> = {
    data: { id: 1, name: 'John' },
    status: 'success',
    message: 'User fetched successfully',
    createdAt: new Date(),
    updatedAt: new Date()
}`)

// æ˜ å°„å‹åˆ¥ç¯„ä¾‹
const mappedTypesCode = ref(`// æ˜ å°„å‹åˆ¥ï¼šå°‡ç¾æœ‰å‹åˆ¥çš„æ‰€æœ‰å±¬æ€§è½‰æ›ç‚ºæ–°å‹åˆ¥
interface User {
    id: number
    name: string
    email: string
    age: number
}

// å°‡æ‰€æœ‰å±¬æ€§è®Šç‚ºå¯é¸
type PartialUser = {
    [K in keyof User]?: User[K]
}
// ç­‰åŒæ–¼: Partial<User>

// å°‡æ‰€æœ‰å±¬æ€§è®Šç‚ºå­—ä¸²å‹åˆ¥
type StringifiedUser = {
    [K in keyof User]: string
}

// å‰µå»ºä¸€å€‹é©—è­‰å™¨å‹åˆ¥
type UserValidator = {
    [K in keyof User]: (value: User[K]) => boolean
}

// å¯¦éš›æ‡‰ç”¨ï¼šè¡¨å–®ç‹€æ…‹ç®¡ç†
type FormState<T> = {
    [K in keyof T]: {
        value: T[K]
        error?: string
        touched: boolean
    }
}

type UserFormState = FormState<User>
// çµæœï¼šæ¯å€‹æ¬„ä½éƒ½æœ‰ value, error, touched å±¬æ€§`)

// ç´¢å¼•å­˜å–å‹åˆ¥ç¯„ä¾‹
const indexAccessCode = ref(`// ç´¢å¼•å­˜å–å‹åˆ¥ï¼šå¾ç¾æœ‰å‹åˆ¥ä¸­æå–ç‰¹å®šå±¬æ€§çš„å‹åˆ¥
interface User {
    id: number
    profile: {
        name: string
        email: string
        avatar: string
    }
    settings: {
        theme: 'light' | 'dark'
        notifications: boolean
    }
}

// æå–ç‰¹å®šå±¬æ€§çš„å‹åˆ¥
type UserID = User['id']                    // number
type UserProfile = User['profile']          // { name: string; email: string; avatar: string }
type ProfileName = User['profile']['name']  // string
type Theme = User['settings']['theme']      // 'light' | 'dark'

// æå–é™£åˆ—å…ƒç´ å‹åˆ¥
type Users = User[]
type SingleUser = Users[number]  // User

// å¯¦éš›æ‡‰ç”¨ï¼šå‹•æ…‹æå– API éŸ¿æ‡‰å‹åˆ¥
interface ApiResponse {
    users: User[]
    posts: Post[]
    comments: Comment[]
}

type UsersData = ApiResponse['users']        // User[]
type SingleUserFromApi = UsersData[number]   // User`)

// é€²éšæ³›å‹ç¯„ä¾‹
const advancedGenericsCode = ref(`// æ³›å‹ç´„æŸï¼šé™åˆ¶æ³›å‹å¿…é ˆå…·æœ‰ç‰¹å®šå±¬æ€§
interface Identifiable {
    id: string | number
}

// T å¿…é ˆæœ‰ id å±¬æ€§
function updateEntity<T extends Identifiable>(entity: T, updates: Partial<T>): T {
    return { ...entity, ...updates }
}

// æ¢ä»¶æ³›å‹ï¼šæ ¹æ“šè¼¸å…¥å‹åˆ¥æ±ºå®šè¼¸å‡ºå‹åˆ¥
type ApiResult<T> = T extends string
    ? { message: T }
    : T extends number
    ? { count: T }
    : { data: T }

// æ³›å‹å·¥å…·å‡½æ•¸
function processData<T>(data: T): ApiResult<T> {
    if (typeof data === 'string') {
        return { message: data } as ApiResult<T>
    }
    if (typeof data === 'number') {
        return { count: data } as ApiResult<T>
    }
    return { data } as ApiResult<T>
}

// ä½¿ç”¨ç¯„ä¾‹
const stringResult = processData("Hello")     // { message: string }
const numberResult = processData(42)          // { count: number }
const objectResult = processData({ id: 1 })  // { data: { id: number } }`)

// æ¢ä»¶å‹åˆ¥ç¯„ä¾‹
const conditionalTypesCode = ref(`// æ¢ä»¶å‹åˆ¥çš„åŸºæœ¬èªæ³•ï¼šT extends U ? X : Y
type IsString<T> = T extends string ? true : false

type Test1 = IsString<string>  // true
type Test2 = IsString<number>  // false

// å¯¦ç”¨çš„æ¢ä»¶å‹åˆ¥ï¼šæå–å‡½æ•¸è¿”å›å€¼å‹åˆ¥
type ReturnType<T> = T extends (...args: any[]) => infer R ? R : never

function getName(): string { return "John" }
function getAge(): number { return 25 }

type NameType = ReturnType<typeof getName>  // string
type AgeType = ReturnType<typeof getAge>    // number

// è¤‡é›œæ¢ä»¶å‹åˆ¥ï¼šæ·±åº¦æå–å·¢ç‹€å±¬æ€§
type DeepExtract<T, K extends string> = K extends \`\${infer First}.\${infer Rest}\`
    ? First extends keyof T
        ? DeepExtract<T[First], Rest>
        : never
    : K extends keyof T
    ? T[K]
    : never

interface Company {
    user: {
        profile: {
            name: string
            email: string
        }
    }
}

type UserName = DeepExtract<Company, 'user.profile.name'>  // string`)

// å¯¦ç”¨å‹åˆ¥ç¯„ä¾‹
const utilityTypesCode = ref(`// TypeScript å…§å»ºå¯¦ç”¨å‹åˆ¥æ‡‰ç”¨
interface User {
    id: number
    name: string
    email: string
    password: string
    role: 'admin' | 'user'
}

// Partial<T> - æ‰€æœ‰å±¬æ€§è®Šç‚ºå¯é¸
type PartialUser = Partial<User>  // ç”¨æ–¼æ›´æ–°æ“ä½œ

// Required<T> - æ‰€æœ‰å±¬æ€§è®Šç‚ºå¿…éœ€
interface UserConfig {
    theme?: 'light' | 'dark'
    notifications?: boolean
}
type RequiredConfig = Required<UserConfig>

// Pick<T, K> - é¸æ“‡ç‰¹å®šå±¬æ€§
type PublicUser = Pick<User, 'id' | 'name' | 'email'>  // å…¬é–‹ç”¨æˆ¶è³‡è¨Š

// Omit<T, K> - æ’é™¤ç‰¹å®šå±¬æ€§
type UserWithoutPassword = Omit<User, 'password'>      // å®‰å…¨çš„ç”¨æˆ¶å‹åˆ¥

// Record<K, T> - å»ºç«‹å­—å…¸å‹åˆ¥
type UserRoles = Record<string, User[]>  // { [key: string]: User[] }

// Extract<T, U> - æå–å¯è³¦å€¼çš„å‹åˆ¥
type StringOrNumber = string | number | boolean
type OnlyStringOrNumber = Extract<StringOrNumber, string | number>  // string | number

// Exclude<T, U> - æ’é™¤å¯è³¦å€¼çš„å‹åˆ¥
type WithoutBoolean = Exclude<StringOrNumber, boolean>  // string | number

// å¯¦éš›æ‡‰ç”¨çµ„åˆ
type CreateUserRequest = Pick<User, 'name' | 'email' | 'password'>
type UpdateUserRequest = Partial<Pick<User, 'name' | 'email'>>
type UserResponse = Omit<User, 'password'>`)

// é¡åˆ¥è£é£¾å™¨ç¯„ä¾‹
const classDecoratorCode = ref(`// é¡åˆ¥è£é£¾å™¨ï¼šä¿®æ”¹é¡åˆ¥çš„è¡Œç‚º
function Component(config: { selector: string }) {
    return function<T extends new (...args: any[]) => any>(constructor: T) {
        // æ·»åŠ  metadata
        (constructor as any).selector = config.selector

        // è¿”å›æ–°çš„é¡åˆ¥æˆ–ä¿®æ”¹ç¾æœ‰é¡åˆ¥
        return class extends constructor {
            selector = config.selector

            constructor(...args: any[]) {
                super(...args)
                console.log(\`Component \${config.selector} created\`)
            }
        }
    }
}

// ä½¿ç”¨è£é£¾å™¨
@Component({ selector: 'user-list' })
class UserListComponent {
    users: User[] = []

    render() {
        return \`<div>Users: \${this.users.length}</div>\`
    }
}

// å¤šå€‹è£é£¾å™¨çµ„åˆ
function Injectable(target: any) {
    target.injectable = true
    return target
}

@Injectable
@Component({ selector: 'app-header' })
class HeaderComponent {
    title = 'My App'
}`)

// æ–¹æ³•è£é£¾å™¨ç¯„ä¾‹
const methodDecoratorCode = ref(`// æ–¹æ³•è£é£¾å™¨ï¼šå¢å¼·æ–¹æ³•åŠŸèƒ½
function Log(target: any, propertyName: string, descriptor: PropertyDescriptor) {
    const method = descriptor.value

    descriptor.value = function (...args: any[]) {
        console.log(\`Calling \${propertyName} with arguments:\`, args)
        const start = performance.now()

        const result = method.apply(this, args)

        const end = performance.now()
        console.log(\`\${propertyName} executed in \${end - start}ms\`)

        return result
    }
}

// æ¬Šé™æª¢æŸ¥è£é£¾å™¨
function RequireAuth(roles: string[] = []) {
    return function (target: any, propertyName: string, descriptor: PropertyDescriptor) {
        const method = descriptor.value

        descriptor.value = function (...args: any[]) {
            // æª¢æŸ¥æ¬Šé™é‚è¼¯
            const userRole = this.getCurrentUserRole?.() || 'guest'

            if (roles.length > 0 && !roles.includes(userRole)) {
                throw new Error(\`Access denied. Required roles: \${roles.join(', ')}\`)
            }

            return method.apply(this, args)
        }
    }
}

class UserService {
    @Log
    @RequireAuth(['admin'])
    async deleteUser(id: number): Promise<void> {
        // åˆªé™¤ç”¨æˆ¶é‚è¼¯
        console.log(\`Deleting user \${id}\`)
    }

    @Log
    async getUser(id: number): Promise<User> {
        // ç²å–ç”¨æˆ¶é‚è¼¯
        return { id, name: 'John', email: 'john@example.com' }
    }
}`)

// å±¬æ€§è£é£¾å™¨ç¯„ä¾‹
const propertyDecoratorCode = ref(`// å±¬æ€§è£é£¾å™¨ï¼šæ§åˆ¶å±¬æ€§è¡Œç‚º
function Validate(validator: (value: any) => boolean, message: string) {
    return function (target: any, propertyName: string) {
        let value: any

        Object.defineProperty(target, propertyName, {
            get() {
                return value
            },
            set(newValue: any) {
                if (!validator(newValue)) {
                    throw new Error(\`Validation failed for \${propertyName}: \${message}\`)
                }
                value = newValue
            },
            enumerable: true,
            configurable: true
        })
    }
}

// æ ¼å¼åŒ–è£é£¾å™¨
function Format(formatter: (value: any) => any) {
    return function (target: any, propertyName: string) {
        let value: any

        Object.defineProperty(target, propertyName, {
            get() {
                return formatter(value)
            },
            set(newValue: any) {
                value = newValue
            }
        })
    }
}

class User {
    @Validate(val => typeof val === 'string' && val.length > 0, 'Name must be a non-empty string')
    name: string

    @Validate(val => /^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$/.test(val), 'Invalid email format')
    email: string

    @Format(val => val?.toUpperCase())
    code: string

    constructor(name: string, email: string, code: string) {
        this.name = name
        this.email = email
        this.code = code
    }
}

// ä½¿ç”¨ç¯„ä¾‹
const user = new User('John', 'john@example.com', 'abc123')
console.log(user.code)  // 'ABC123'`)

// API ç³»çµ±ç¯„ä¾‹
const apiSystemCode = ref(`// ä¼æ¥­ç´šå‹åˆ¥å®‰å…¨ API ç³»çµ±
// åŸºç¤å‹åˆ¥å®šç¾©
interface BaseEntity {
    id: string
    createdAt: Date
    updatedAt: Date
}

// API éŸ¿æ‡‰åŒ…è£å™¨
type ApiResponse<T> = {
    data: T
    success: boolean
    message: string
    timestamp: Date
}

// API éŒ¯èª¤å‹åˆ¥
type ApiError = {
    code: string
    message: string
    details?: Record<string, any>
}

// CRUD æ“ä½œå‹åˆ¥
type CreateRequest<T> = Omit<T, keyof BaseEntity>
type UpdateRequest<T> = Partial<Omit<T, keyof BaseEntity>>
type QueryOptions = {
    page?: number
    limit?: number
    sort?: string
    filter?: Record<string, any>
}

// æ³›å‹ API å®¢æˆ¶ç«¯
class ApiClient<T extends BaseEntity> {
    constructor(private endpoint: string) {}

    async findAll(options?: QueryOptions): Promise<ApiResponse<T[]>> {
        // å¯¦ä½œç²å–åˆ—è¡¨é‚è¼¯
        return this.request('GET', '', { params: options })
    }

    async findById(id: string): Promise<ApiResponse<T>> {
        return this.request('GET', \`/\${id}\`)
    }

    async create(data: CreateRequest<T>): Promise<ApiResponse<T>> {
        return this.request('POST', '', { body: data })
    }

    async update(id: string, data: UpdateRequest<T>): Promise<ApiResponse<T>> {
        return this.request('PATCH', \`/\${id}\`, { body: data })
    }

    async delete(id: string): Promise<ApiResponse<void>> {
        return this.request('DELETE', \`/\${id}\`)
    }

    private async request<R>(
        method: string,
        path: string,
        options?: { params?: any; body?: any }
    ): Promise<ApiResponse<R>> {
        // HTTP è«‹æ±‚å¯¦ä½œ
        const url = \`\${this.endpoint}\${path}\`
        // ... å¯¦éš›è«‹æ±‚é‚è¼¯
        return {} as ApiResponse<R>
    }
}

// å…·é«”å¯¦é«”å‹åˆ¥
interface User extends BaseEntity {
    name: string
    email: string
    role: 'admin' | 'user'
}

interface Post extends BaseEntity {
    title: string
    content: string
    authorId: string
    published: boolean
}

// ä½¿ç”¨ç¯„ä¾‹
const userApi = new ApiClient<User>('/api/users')
const postApi = new ApiClient<Post>('/api/posts')

// å‹åˆ¥å®‰å…¨çš„ API èª¿ç”¨
async function example() {
    // å‰µå»ºç”¨æˆ¶ - è‡ªå‹•æ¨æ–·å‹åˆ¥ï¼Œæ’é™¤ BaseEntity å±¬æ€§
    const newUser = await userApi.create({
        name: 'John Doe',
        email: 'john@example.com',
        role: 'user'
    })

    // æ›´æ–°ç”¨æˆ¶ - æ‰€æœ‰å±¬æ€§éƒ½æ˜¯å¯é¸çš„
    const updatedUser = await userApi.update('user-id', {
        name: 'John Smith'  // åªæ›´æ–°åç¨±
    })

    // ç²å–ç”¨æˆ¶åˆ—è¡¨ - å¸¶åˆ†é å’Œç¯©é¸
    const users = await userApi.findAll({
        page: 1,
        limit: 10,
        filter: { role: 'admin' }
    })
}`)

// é¡åˆ¥è£é£¾å™¨ç·¨è­¯å‰å¾Œå°æ¯”ç¯„ä¾‹
const classDecoratorOriginal = ref(`// TypeScript è£é£¾å™¨èªæ³•
function Component(options: { selector: string }) {
    return function (target: any) {
        target.selector = options.selector
        target.isComponent = true
        return target
    }
}

@Component({ selector: 'app-user' })
class UserComponent {
    name: string = 'User'

    render() {
        return \`<div>Hello \${this.name}</div>\`
    }
}`)

const classDecoratorCompiled = ref(`// ç·¨è­¯å¾Œçš„ JavaScript
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function")
        r = Reflect.decorate(decorators, target, key, desc);
    else
        for (var i = decorators.length - 1; i >= 0; i--)
            if (d = decorators[i])
                r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};

function Component(options) {
    return function (target) {
        target.selector = options.selector;
        target.isComponent = true;
        return target;
    };
}

var UserComponent = /** @class */ (function () {
    function UserComponent() {
        this.name = 'User';
    }
    UserComponent.prototype.render = function () {
        return "<div>Hello " + this.name + "</div>";
    };
    UserComponent = __decorate([
        Component({ selector: 'app-user' })
    ], UserComponent);
    return UserComponent;
}());`)

// æ–¹æ³•è£é£¾å™¨ç·¨è­¯å‰å¾Œå°æ¯”ç¯„ä¾‹
const methodDecoratorOriginal = ref(`// TypeScript æ–¹æ³•è£é£¾å™¨
function Log(target: any, propertyName: string, descriptor: PropertyDescriptor) {
    const method = descriptor.value

    descriptor.value = function (...args: any[]) {
        console.log(\`Calling \${propertyName} with:\`, args)
        const result = method.apply(this, args)
        console.log(\`\${propertyName} returned:\`, result)
        return result
    }
}

class UserService {
    @Log
    getUser(id: number): Promise<User> {
        return fetch(\`/api/users/\${id}\`).then(res => res.json())
    }
}`)

const methodDecoratorCompiled = ref(`// ç·¨è­¯å¾Œçš„ JavaScript
function Log(target, propertyName, descriptor) {
    var method = descriptor.value;
    descriptor.value = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        console.log("Calling " + propertyName + " with:", args);
        var result = method.apply(this, args);
        console.log(propertyName + " returned:", result);
        return result;
    };
}

var UserService = /** @class */ (function () {
    function UserService() {
    }
    UserService.prototype.getUser = function (id) {
        return fetch("/api/users/" + id).then(function (res) { return res.json(); });
    };
    __decorate([
        Log
    ], UserService.prototype, "getUser", null);
    return UserService;
}());`)

// å±¬æ€§è£é£¾å™¨ç·¨è­¯å‰å¾Œå°æ¯”ç¯„ä¾‹
const propertyDecoratorOriginal = ref(`// TypeScript å±¬æ€§è£é£¾å™¨
function Validate(validator: (value: any) => boolean) {
    return function (target: any, propertyName: string) {
        let value: any

        Object.defineProperty(target, propertyName, {
            get() { return value },
            set(newValue: any) {
                if (!validator(newValue)) {
                    throw new Error(\`Invalid value for \${propertyName}\`)
                }
                value = newValue
            }
        })
    }
}

class User {
    @Validate(val => typeof val === 'string' && val.length > 0)
    name: string

    constructor(name: string) {
        this.name = name
    }
}`)

const propertyDecoratorCompiled = ref(`// ç·¨è­¯å¾Œçš„ JavaScript
function Validate(validator) {
    return function (target, propertyName) {
        var value;
        Object.defineProperty(target, propertyName, {
            get: function () { return value; },
            set: function (newValue) {
                if (!validator(newValue)) {
                    throw new Error("Invalid value for " + propertyName);
                }
                value = newValue;
            },
            enumerable: true,
            configurable: true
        });
    };
}

var User = /** @class */ (function () {
    function User(name) {
        this.name = name;
    }
    __decorate([
        Validate(function (val) { return typeof val === 'string' && val.length > 0; })
    ], User.prototype, "name", void 0);
    return User;
}());`)
</script>

<style scoped>
.advanced-typescript {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem;
}

.section-intro {
    margin-bottom: 3rem;
    text-align: center;
}

.section-intro h2 {
    margin-bottom: 1rem;
    font-size: 2rem;
    font-weight: 700;
    color: #2d3748;
}

.section-description {
    font-size: 1.125rem;
    color: #4a5568;
    line-height: 1.6;
    max-width: 800px;
    margin: 0 auto;
}

.content-section {
    margin-bottom: 4rem;
}

.content-section h3 {
    margin-bottom: 2rem;
    font-size: 1.5rem;
    font-weight: 600;
    color: #2d3748;
}

.type-category,
.generic-section,
.conditional-section,
.utility-section,
.decorator-category {
    margin-bottom: 3rem;
    padding: 1.5rem;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: #f8f9fa;
}

.type-category h4,
.generic-section h4,
.conditional-section h4,
.utility-section h4,
.decorator-category h4 {
    margin-bottom: 1rem;
    font-size: 1.25rem;
    font-weight: 600;
    color: #2d3748;
}

.decorator-intro {
    margin-bottom: 2rem;
    padding: 1rem;
    background: #ebf8ff;
    border-left: 4px solid #4299e1;
    border-radius: 4px;
}

.practice-description {
    margin-bottom: 2rem;
    padding: 1rem;
    background: #f0fff4;
    border-left: 4px solid #48bb78;
    border-radius: 4px;
}

.best-practices {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.practice-item {
    padding: 1.5rem;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
}

.practice-item h4 {
    margin-bottom: 1rem;
    font-size: 1.125rem;
    font-weight: 600;
    color: #2d3748;
}

.practice-item ul {
    list-style: none;
    margin: 0;
    padding: 0;
}

.practice-item li {
    margin-bottom: 0.5rem;
    color: #4a5568;
    font-size: 0.875rem;
    line-height: 1.4;
    padding-left: 1.5rem;
    position: relative;
}

.practice-item li::before {
    content: "âœ“";
    position: absolute;
    left: 0;
    color: #48bb78;
    font-weight: bold;
}
</style>
