<template>
    <div class="project-integration">
        <div class="section-intro">
            <h2>ğŸš€ å¯¦æˆ°é …ç›®æ•´åˆ - å“¡å·¥ç®¡ç†ç³»çµ±</h2>
            <p class="section-description">
                é€éå®Œæ•´çš„å“¡å·¥ç®¡ç†ç³»çµ±å¯¦ä½œï¼ŒæŒæ¡ TypeScript + Axios åœ¨ä¼æ¥­ç´šæ‡‰ç”¨ä¸­çš„æœ€ä½³å¯¦è¸ã€‚
                æœ¬ç« ç¯€å°‡å¸¶æ‚¨å¾é›¶é–‹å§‹å»ºç«‹ä¸€å€‹å…·æœ‰å®Œæ•´ CRUD åŠŸèƒ½çš„ç³»çµ±ã€‚
            </p>
        </div>

        <!-- å°ˆæ¡ˆæ¦‚è¿° -->
        <div class="content-section">
            <h3>ğŸ“‹ å°ˆæ¡ˆèªªæ˜</h3>
            <div class="project-overview">
                <p>
                    æ‚¨å°‡å¯¦ä½œä¸€å€‹å“¡å·¥ç®¡ç†ç³»çµ±ï¼Œé€™æ˜¯ä¼æ¥­æ‡‰ç”¨ä¸­æœ€å¸¸è¦‹çš„å ´æ™¯ã€‚
                    ç³»çµ±åŒ…å«å“¡å·¥è³‡æ–™ç®¡ç†ã€éƒ¨é–€é—œè¯ã€æœå°‹ç¯©é¸ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚
                </p>

                <div class="feature-list">
                    <h4>ğŸ¯ ç³»çµ±åŠŸèƒ½</h4>
                    <ul>
                        <li>âœ… å“¡å·¥ CRUD æ“ä½œï¼ˆæ–°å¢ã€æŸ¥è©¢ã€ç·¨è¼¯ã€åˆªé™¤ï¼‰</li>
                        <li>âœ… éƒ¨é–€ç®¡ç†èˆ‡å“¡å·¥éƒ¨é–€é—œè¯</li>
                        <li>âœ… æœå°‹èˆ‡ç¯©é¸åŠŸèƒ½</li>
                        <li>âœ… åˆ†é ç€è¦½èˆ‡æ’åº</li>
                        <li>âœ… è¡¨å–®é©—è­‰èˆ‡éŒ¯èª¤è™•ç†</li>
                        <li>âœ… è¼‰å…¥ç‹€æ…‹ç®¡ç†</li>
                    </ul>
                </div>
            </div>
        </div>

            <!-- ç’°å¢ƒæº–å‚™ -->
    <div class="content-section">
      <h3>ğŸ ç’°å¢ƒæº–å‚™</h3>
      <div class="setup-instructions">
        <div class="step-card">
          <h4>ä¸€éµå•Ÿå‹•é–‹ç™¼ç’°å¢ƒ</h4>
          <CodeBlock
            title="å•Ÿå‹•å®Œæ•´é–‹ç™¼ç’°å¢ƒ"
            language="bash"
            :code="setupEnvironmentCode"
            explanation="åŒæ™‚å•Ÿå‹• JSON Server (API) å’Œ Vue é–‹ç™¼ä¼ºæœå™¨ï¼Œè‡ªå‹•é…ç½®ä»£ç†è¨­å®š"
          />
        </div>

        <div class="step-card">
          <h4>é©—è­‰ç’°å¢ƒ</h4>
          <CodeBlock
            title="æª¢æŸ¥æœå‹™ç‹€æ…‹"
            language="bash"
            :code="verifyEnvironmentCode"
            explanation="ç¢ºèªå‰ç«¯å’Œ API æœå‹™éƒ½æ­£å¸¸é‹è¡Œ"
          />
        </div>
      </div>
    </div>

        <!-- ä»»å‹™ 1ï¼šå‹åˆ¥å®šç¾© -->
        <div class="content-section">
            <h3>ğŸ“ ä»»å‹™ 1ï¼šå»ºç«‹å‹åˆ¥å®šç¾© (30 åˆ†é˜)</h3>

            <div class="task-section">
                <h4>1.1 å“¡å·¥å‹åˆ¥å®šç¾© (src/types/employee.ts)</h4>
                <p>é¦–å…ˆå»ºç«‹æ ¸å¿ƒçš„å“¡å·¥è³‡æ–™çµæ§‹ï¼š</p>

                <CodeBlock
                    title="Employee ä»‹é¢å®šç¾©"
                    language="typescript"
                    :code="employeeTypeCode"
                    explanation="å®šç¾©å“¡å·¥çš„å®Œæ•´è³‡æ–™çµæ§‹ï¼ŒåŒ…å«æ‰€æœ‰å¿…è¦æ¬„ä½å’Œå‹åˆ¥ç´„æŸ"
                />

                <CodeBlock
                    title="å“¡å·¥æœå°‹åƒæ•¸å‹åˆ¥"
                    language="typescript"
                    :code="searchParamsCode"
                    explanation="æ”¯æ´å¤šç¨®æœå°‹æ¢ä»¶ï¼ŒåŒ…å« JSON Server ç‰¹æ®ŠæŸ¥è©¢åƒæ•¸"
                />
            </div>

            <div class="task-section">
                <h4>1.2 è¡¨å–®å‹åˆ¥å®šç¾© (src/types/forms.ts)</h4>

                <CodeBlock
                    title="è¡¨å–®å‹åˆ¥å®šç¾©"
                    language="typescript"
                    :code="formTypesCode"
                    explanation="å®šç¾©è¡¨å–®è³‡æ–™çµæ§‹å’Œé©—è­‰ç›¸é—œå‹åˆ¥"
                />
            </div>

            <div class="task-section">
                <h4>1.3 API éŸ¿æ‡‰å‹åˆ¥ (src/types/api.ts)</h4>

                <CodeBlock
                    title="API éŸ¿æ‡‰å‹åˆ¥"
                    language="typescript"
                    :code="apiTypesCode"
                    explanation="å®šç¾© API éŸ¿æ‡‰æ ¼å¼å’Œåˆ†é è³‡æ–™çµæ§‹"
                />
            </div>
        </div>

        <!-- ä»»å‹™ 2ï¼šAPI æœå‹™å¯¦ä½œ -->
        <div class="content-section">
            <h3>ğŸ”§ ä»»å‹™ 2ï¼šAPI æœå‹™å¯¦ä½œ (45 åˆ†é˜)</h3>

            <div class="task-section">
                <h4>2.1 åŸºç¤ API å®¢æˆ¶ç«¯ (src/services/base.service.ts)</h4>

                <CodeBlock
                    title="åŸºç¤ API æœå‹™é¡åˆ¥"
                    language="typescript"
                    :code="baseServiceCode"
                    explanation="å»ºç«‹æ³›å‹ API æœå‹™åŸºé¡ï¼Œæä¾›å‹åˆ¥å®‰å…¨çš„ HTTP æ“ä½œ"
                />
            </div>

            <div class="task-section">
                <h4>2.2 å“¡å·¥æœå‹™å¯¦ä½œ (src/services/employee.service.ts)</h4>

                <CodeBlock
                    title="å“¡å·¥æœå‹™å®Œæ•´å¯¦ä½œ"
                    language="typescript"
                    :code="employeeServiceCode"
                    explanation="å¯¦ä½œå“¡å·¥ç›¸é—œçš„æ‰€æœ‰ CRUD æ“ä½œï¼ŒåŒ…å«æœå°‹ã€ç¯©é¸ç­‰é€²éšåŠŸèƒ½"
                />
            </div>
        </div>

        <!-- ä»»å‹™ 3ï¼šComposable å¯¦ä½œ -->
        <div class="content-section">
            <h3>ğŸ¨ ä»»å‹™ 3ï¼šComposable å¯¦ä½œ (45 åˆ†é˜)</h3>

            <div class="task-section">
                <h4>3.1 å“¡å·¥è³‡æ–™ç®¡ç† Composable (src/composables/useEmployees.ts)</h4>

                <CodeBlock
                    title="useEmployees Composable - ç‹€æ…‹å®šç¾©"
                    language="typescript"
                    :code="composableStateCode"
                    explanation="å®šç¾©éŸ¿æ‡‰å¼ç‹€æ…‹ï¼ŒåŒ…å«è³‡æ–™ã€è¼‰å…¥ç‹€æ…‹ã€éŒ¯èª¤ç‹€æ…‹ç­‰"
                />

                <CodeBlock
                    title="useEmployees Composable - æ–¹æ³•å¯¦ä½œ"
                    language="typescript"
                    :code="composableMethodsCode"
                    explanation="å¯¦ä½œè³‡æ–™æ“ä½œæ–¹æ³•ï¼ŒåŒ…å«å®Œæ•´çš„éŒ¯èª¤è™•ç†å’Œç‹€æ…‹ç®¡ç†"
                />
            </div>
        </div>

        <!-- API æ¸¬è©¦æŒ‡å— -->
        <div class="content-section">
            <h3>ğŸ§ª API æ¸¬è©¦æŒ‡å—</h3>

            <div class="api-testing">
                <h4>åŸºæœ¬ CRUD æ“ä½œæ¸¬è©¦</h4>
                <CodeBlock
                    title="API æ¸¬è©¦ç¯„ä¾‹"
                    language="bash"
                    :code="apiTestingCode"
                    explanation="ä½¿ç”¨ curl æˆ–ç€è¦½å™¨é–‹ç™¼å·¥å…·æ¸¬è©¦ API åŠŸèƒ½"
                />

                <h4>é€²éšæŸ¥è©¢æ¸¬è©¦</h4>
                <CodeBlock
                    title="æœå°‹èˆ‡ç¯©é¸ API"
                    language="bash"
                    :code="advancedQueryCode"
                    explanation="æ¸¬è©¦è¤‡é›œçš„æœå°‹ã€ç¯©é¸ã€åˆ†é å’Œæ’åºåŠŸèƒ½"
                />
            </div>
        </div>

        <!-- å¸¸è¦‹å•é¡Œè§£æ±º -->
        <div class="content-section">
            <h3>ğŸ”§ å¸¸è¦‹å•é¡Œè§£æ±º</h3>

            <div class="troubleshooting">
                <div class="problem-section">
                    <h4>TypeScript ç·¨è­¯éŒ¯èª¤</h4>
                    <ul>
                        <li><strong>å•é¡Œ</strong>ï¼šProperty 'xxx' does not exist on type 'Employee'</li>
                        <li><strong>è§£æ±º</strong>ï¼šæª¢æŸ¥å‹åˆ¥å®šç¾©æ˜¯å¦å®Œæ•´ï¼Œç¢ºä¿æ‰€æœ‰å¿…è¦æ¬„ä½éƒ½å·²å®šç¾©</li>
                    </ul>

                    <ul>
                        <li><strong>å•é¡Œ</strong>ï¼šType 'xxx' is not assignable to type 'yyy'</li>
                        <li><strong>è§£æ±º</strong>ï¼šæª¢æŸ¥å‹åˆ¥åŒ¹é…ï¼Œç‰¹åˆ¥æ³¨æ„è¯åˆå‹åˆ¥å’Œå¯é¸å±¬æ€§</li>
                    </ul>
                </div>

                <div class="problem-section">
                    <h4>API å‘¼å«å•é¡Œ</h4>
                    <ul>
                        <li><strong>å•é¡Œ</strong>ï¼šç¶²è·¯éŒ¯èª¤æˆ– 404</li>
                        <li><strong>è§£æ±º</strong>ï¼šç¢ºèª JSON Server é‹è¡Œåœ¨ port 3001ï¼Œæª¢æŸ¥ API URL è·¯å¾‘</li>
                    </ul>

                    <ul>
                        <li><strong>å•é¡Œ</strong>ï¼šCORS éŒ¯èª¤</li>
                        <li><strong>è§£æ±º</strong>ï¼šæª¢æŸ¥ vite.config.ts ä¸­çš„ proxy è¨­å®š</li>
                    </ul>
                </div>

                <div class="problem-section">
                    <h4>éŸ¿æ‡‰å¼ç‹€æ…‹å•é¡Œ</h4>
                    <ul>
                        <li><strong>å•é¡Œ</strong>ï¼šè³‡æ–™æ›´æ–°ä½†ç•«é¢æœªé‡æ–°æ¸²æŸ“</li>
                        <li><strong>è§£æ±º</strong>ï¼šç¢ºèªä½¿ç”¨ ref() åŒ…è£è³‡æ–™ï¼Œæ­£ç¢ºæ›´æ–° .value å±¬æ€§</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- å®Œæˆæª¢æŸ¥æ¸…å–® -->
        <div class="content-section">
            <h3>âœ… å®Œæˆæª¢æŸ¥æ¸…å–®</h3>

            <div class="checklist">
                <div class="checklist-section">
                    <h4>å‹åˆ¥å®šç¾©</h4>
                    <ul class="checkbox-list">
                        <li>â–¡ Employee ä»‹é¢åŒ…å«æ‰€æœ‰å¿…è¦æ¬„ä½</li>
                        <li>â–¡ EmployeeSearchParams æ”¯æ´å„ç¨®æŸ¥è©¢åƒæ•¸</li>
                        <li>â–¡ CreateEmployeeForm å’Œ UpdateEmployeeForm æ­£ç¢ºå®šç¾©</li>
                        <li>â–¡ ä½¿ç”¨è¯åˆå‹åˆ¥é™åˆ¶ status æ¬„ä½å€¼</li>
                        <li>â–¡ ä½¿ç”¨ keyof å’Œå‹åˆ¥å¼•ç”¨</li>
                    </ul>
                </div>

                <div class="checklist-section">
                    <h4>API æœå‹™</h4>
                    <ul class="checkbox-list">
                        <li>â–¡ æ‰€æœ‰ CRUD æ“ä½œæ–¹æ³•éƒ½å·²å¯¦ä½œ</li>
                        <li>â–¡ æ­£ç¢ºä½¿ç”¨æ³›å‹æŒ‡å®šå›å‚³å’Œè«‹æ±‚å‹åˆ¥</li>
                        <li>â–¡ URL è·¯å¾‘å’Œ HTTP æ–¹æ³•æ­£ç¢ºå°æ‡‰</li>
                        <li>â–¡ æŸ¥è©¢åƒæ•¸æ­£ç¢ºå‚³é</li>
                    </ul>
                </div>

                <div class="checklist-section">
                    <h4>Composable</h4>
                    <ul class="checkbox-list">
                        <li>â–¡ éŸ¿æ‡‰å¼ç‹€æ…‹æ­£ç¢ºå®šç¾©</li>
                        <li>â–¡ è¼‰å…¥å’ŒéŒ¯èª¤ç‹€æ…‹å®Œæ•´è™•ç†</li>
                        <li>â–¡ è¨ˆç®—å±¬æ€§æŒ‰é æœŸå·¥ä½œ</li>
                        <li>â–¡ é™£åˆ—æ“ä½œæ­£ç¢ºæ›´æ–°æœ¬åœ°ç‹€æ…‹</li>
                    </ul>
                </div>

                <div class="checklist-section">
                    <h4>åŠŸèƒ½æ¸¬è©¦</h4>
                    <ul class="checkbox-list">
                        <li>â–¡ å“¡å·¥åˆ—è¡¨æ­£ç¢ºè¼‰å…¥å’Œé¡¯ç¤º</li>
                        <li>â–¡ æœå°‹å’Œç¯©é¸åŠŸèƒ½æ­£å¸¸</li>
                        <li>â–¡ æ–°å¢å“¡å·¥æˆåŠŸ</li>
                        <li>â–¡ ç·¨è¼¯å“¡å·¥è³‡æ–™æ›´æ–°æ­£ç¢º</li>
                        <li>â–¡ åˆªé™¤åŠŸèƒ½æ­£å¸¸</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- é€²éšæŒ‘æˆ° -->
        <div class="content-section">
            <h3>ğŸš€ é€²éšæŒ‘æˆ°</h3>

            <div class="advanced-challenges">
                <div class="challenge-card">
                    <h4>ğŸ” è¡¨å–®é©—è­‰</h4>
                    <ul>
                        <li>å¯¦ä½œ email æ ¼å¼é©—è­‰</li>
                        <li>åŠ å…¥å¿…å¡«æ¬„ä½æª¢æŸ¥</li>
                        <li>å»ºç«‹é©—è­‰è¦å‰‡çµ„åˆ</li>
                    </ul>
                </div>

                <div class="challenge-card">
                    <h4>ğŸ”„ éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶</h4>
                    <ul>
                        <li>API å¤±æ•—è‡ªå‹•é‡è©¦</li>
                        <li>æŒ‡æ•¸é€€é¿ç­–ç•¥</li>
                        <li>é‡è©¦æ¬¡æ•¸é™åˆ¶</li>
                    </ul>
                </div>

                <div class="challenge-card">
                    <h4>ğŸ’¾ é›¢ç·šæ”¯æ´</h4>
                    <ul>
                        <li>localStorage è³‡æ–™å¿«å–</li>
                        <li>ç¶²è·¯ç‹€æ…‹åµæ¸¬</li>
                        <li>é›¢ç·šè³‡æ–™åŒæ­¥</li>
                    </ul>
                </div>

                <div class="challenge-card">
                    <h4>âš¡ æ•ˆèƒ½å„ªåŒ–</h4>
                    <ul>
                        <li>è™›æ“¬æ»¾å‹•å¯¦ä½œ</li>
                        <li>é˜²æŠ–æœå°‹</li>
                        <li>computed è¨˜æ†¶åŒ–</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- å­¸ç¿’ç¸½çµ -->
        <div class="content-section">
            <h3>ğŸ“š å­¸ç¿’ç¸½çµ</h3>

            <div class="learning-summary">
                <div class="summary-card">
                    <h4>TypeScript æ ¸å¿ƒæŠ€èƒ½</h4>
                    <ul>
                        <li>ä»‹é¢å®šç¾©å’Œå‹åˆ¥è¨»è§£</li>
                        <li>è¯åˆå‹åˆ¥å’Œæ¢ä»¶å‹åˆ¥</li>
                        <li>æ³›å‹çš„å¯¦éš›æ‡‰ç”¨</li>
                        <li>å‹åˆ¥å¼•ç”¨å’Œ keyof æ“ä½œç¬¦</li>
                    </ul>
                </div>

                <div class="summary-card">
                    <h4>Axios æ•´åˆæŠ€èƒ½</h4>
                    <ul>
                        <li>HTTP å®¢æˆ¶ç«¯è¨­å®š</li>
                        <li>RESTful API å‘¼å«</li>
                        <li>è«‹æ±‚å’ŒéŸ¿æ‡‰å‹åˆ¥å®‰å…¨</li>
                        <li>éŒ¯èª¤è™•ç†ç­–ç•¥</li>
                    </ul>
                </div>

                <div class="summary-card">
                    <h4>Vue 3 æ•´åˆæŠ€èƒ½</h4>
                    <ul>
                        <li>Composition API èˆ‡ TypeScript æ•´åˆ</li>
                        <li>éŸ¿æ‡‰å¼ç‹€æ…‹ç®¡ç†</li>
                        <li>è¨ˆç®—å±¬æ€§å’Œç›£è½å™¨</li>
                        <li>å…ƒä»¶é–“çš„å‹åˆ¥å®‰å…¨é€šä¿¡</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import CodeBlock from '@/components/common/CodeBlock.vue'

// ç’°å¢ƒè¨­å®šä»£ç¢¼
const setupEnvironmentCode = ref(`# ä¸€éµå•Ÿå‹•å®Œæ•´é–‹ç™¼ç’°å¢ƒ
npm run start

# æ­¤å‘½ä»¤æœƒåŒæ™‚å•Ÿå‹•ï¼š
# - JSON Server (API æœå‹™) - Port 3001
# - Vue é–‹ç™¼ä¼ºæœå™¨ - Port 5173
# - è‡ªå‹•è¨­å®š API ä»£ç†åˆ° /api`)

const verifyEnvironmentCode = ref(`# é©—è­‰æœå‹™é‹è¡Œç‹€æ…‹

# å‰ç«¯æœå‹™ï¼š
# http://localhost:5173

# API æœå‹™ï¼š
# http://localhost:3001/api/employees

# æ¸¬è©¦ API æ˜¯å¦æ­£å¸¸ï¼š
curl http://localhost:3001/api/employees

# æˆ–åœ¨ç€è¦½å™¨ä¸­æŸ¥çœ‹ API æ–‡æª”ï¼š
# http://localhost:3001/api`)

// å‹åˆ¥å®šç¾©ä»£ç¢¼
const employeeTypeCode = ref(`// src/types/employee.ts
export interface Employee {
  id: number                    // å“¡å·¥ ID
  name: string                  // å“¡å·¥å§“å
  email: string                 // é›»å­éƒµä»¶
  phone: string                 // é›»è©±è™Ÿç¢¼
  position: string              // è·ä½
  departmentId: number          // éƒ¨é–€ ID
  salary: number                // è–ªè³‡
  hireDate: string              // åˆ°è·æ—¥æœŸ
  status: 'active' | 'inactive' | 'terminated'  // å“¡å·¥ç‹€æ…‹
  avatar?: string               // é ­åƒ URLï¼ˆå¯é¸ï¼‰
}

// éƒ¨é–€ä»‹é¢
export interface Department {
  id: number
  name: string
  description?: string
}`)

const searchParamsCode = ref(`// å“¡å·¥æœå°‹åƒæ•¸ä»‹é¢
export interface EmployeeSearchParams {
  // åŸºæœ¬æœå°‹åƒæ•¸
  name?: string                      // å§“åæœå°‹
  departmentId?: number              // éƒ¨é–€ç¯©é¸
  status?: Employee['status']        // ç‹€æ…‹ç¯©é¸ï¼ˆå¼•ç”¨ Employee çš„ status å‹åˆ¥ï¼‰
  page?: number                      // é ç¢¼
  limit?: number                     // æ¯é æ•¸é‡
  sortBy?: keyof Employee            // æ’åºæ¬„ä½ï¼ˆä½¿ç”¨ keyof ç²å–æ‰€æœ‰éµï¼‰
  sortOrder?: 'asc' | 'desc'         // æ’åºæ–¹å‘

  // JSON Server ç‰¹æ®ŠæŸ¥è©¢åƒæ•¸
  name_like?: string                 // æ¨¡ç³Šæœå°‹å§“å
  position_like?: string             // æ¨¡ç³Šæœå°‹è·ä½
  salary_gte?: number               // è–ªè³‡å¤§æ–¼ç­‰æ–¼
  salary_lte?: number               // è–ªè³‡å°æ–¼ç­‰æ–¼
  hireDate_gte?: string             // å…¥è·æ—¥æœŸå¤§æ–¼ç­‰æ–¼
  hireDate_lte?: string             // å…¥è·æ—¥æœŸå°æ–¼ç­‰æ–¼
  q?: string                        // å…¨æ–‡æœå°‹
  _page?: number                    // JSON Server åˆ†é 
  _limit?: number                   // JSON Server æ¯é æ•¸é‡
  _sort?: string                    // JSON Server æ’åºæ¬„ä½
  _order?: 'asc' | 'desc'           // JSON Server æ’åºæ–¹å‘
}`)

const formTypesCode = ref(`// src/types/forms.ts
export interface CreateEmployeeForm {
  name: string
  email: string
  phone: string
  position: string
  departmentId: number
  salary: number
  hireDate: string
  status: 'active' | 'inactive' | 'terminated'
}

// ä½¿ç”¨ Partial è®“æ‰€æœ‰æ¬„ä½è®Šç‚ºå¯é¸ï¼Œä½† id å¿…é ˆæä¾›
export interface UpdateEmployeeForm extends Partial<CreateEmployeeForm> {
  id: number  // æ›´æ–°æ™‚å¿…é ˆæä¾› ID
}

// è¡¨å–®é©—è­‰éŒ¯èª¤
export interface FormValidationError {
  field: string    // éŒ¯èª¤æ¬„ä½åç¨±
  message: string  // éŒ¯èª¤è¨Šæ¯
}

// é©—è­‰çµæœ
export interface ValidationResult {
  isValid: boolean                 // æ˜¯å¦é€šéé©—è­‰
  errors: FormValidationError[]    // é©—è­‰éŒ¯èª¤åˆ—è¡¨
}`)

const apiTypesCode = ref(`// src/types/api.ts
export interface ApiResponse<T> {
  data: T
  message: string
  success: boolean
  timestamp: string
}

// åˆ†é è³‡è¨Š
export interface PaginationInfo {
  page: number
  limit: number
  total: number
  totalPages: number
}

// å¸¶åˆ†é çš„ API éŸ¿æ‡‰
export interface PaginatedResponse<T> {
  data: T[]
  pagination: PaginationInfo
}

// éŒ¯èª¤å‹åˆ¥
export interface AppError {
  message: string
  code?: string
  status?: number
  details?: unknown
}

// å‹åˆ¥å®‰å…¨çš„ API å®¢æˆ¶ç«¯ä»‹é¢
export interface TypeSafeApiClient {
  get<T>(url: string, params?: Record<string, unknown>): Promise<T>
  post<T, U>(url: string, data: U): Promise<T>
  put<T, U>(url: string, data: U): Promise<T>
  patch<T, U>(url: string, data: U): Promise<T>
  delete<T>(url: string): Promise<T>
  getWithPagination<T>(url: string, params?: Record<string, unknown>): Promise<PaginatedResponse<T>>
}`)

const baseServiceCode = ref(`// src/services/base.service.ts
import axios, { type AxiosInstance, type AxiosResponse } from 'axios'
import type { TypeSafeApiClient, PaginatedResponse, AppError } from '@/types/api'

export abstract class BaseApiService implements TypeSafeApiClient {
  protected client: AxiosInstance

  constructor() {
    this.client = axios.create({
      baseURL: '/api',
      timeout: 10000,
      headers: {
        'Content-Type': 'application/json'
      }
    })

    this.setupInterceptors()
  }

  private setupInterceptors() {
    // è«‹æ±‚æ””æˆªå™¨
    this.client.interceptors.request.use(
      (config) => {
        console.log(\`ğŸ”„ API Request: \${config.method?.toUpperCase()} \${config.url}\`)
        return config
      },
      (error) => {
        console.error('âŒ Request Error:', error)
        return Promise.reject(this.handleError(error))
      }
    )

    // éŸ¿æ‡‰æ””æˆªå™¨
    this.client.interceptors.response.use(
      (response) => {
        console.log(\`âœ… API Response: \${response.status} \${response.config.url}\`)
        return response
      },
      (error) => {
        console.error('âŒ Response Error:', error.response?.status, error.message)
        return Promise.reject(this.handleError(error))
      }
    )
  }

  private handleError(error: any): AppError {
    if (error.response) {
      // ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤
      return {
        message: error.response.data?.message || \`HTTP Error \${error.response.status}\`,
        code: error.response.data?.code,
        status: error.response.status,
        details: error.response.data
      }
    } else if (error.request) {
      // ç¶²è·¯éŒ¯èª¤
      return {
        message: 'ç¶²è·¯é€£ç·šéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®š',
        code: 'NETWORK_ERROR'
      }
    } else {
      // å…¶ä»–éŒ¯èª¤
      return {
        message: error.message || 'ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤',
        code: 'UNKNOWN_ERROR'
      }
    }
  }

  async get<T>(url: string, params?: Record<string, unknown>): Promise<T> {
    const response: AxiosResponse<T> = await this.client.get(url, { params })
    return response.data
  }

  async post<T, U>(url: string, data: U): Promise<T> {
    const response: AxiosResponse<T> = await this.client.post(url, data)
    return response.data
  }

  async put<T, U>(url: string, data: U): Promise<T> {
    const response: AxiosResponse<T> = await this.client.put(url, data)
    return response.data
  }

  async patch<T, U>(url: string, data: U): Promise<T> {
    const response: AxiosResponse<T> = await this.client.patch(url, data)
    return response.data
  }

  async delete<T>(url: string): Promise<T> {
    const response: AxiosResponse<T> = await this.client.delete(url)
    return response.data
  }

  async getWithPagination<T>(
    url: string,
    params?: Record<string, unknown>
  ): Promise<PaginatedResponse<T>> {
    const response = await this.client.get(url, { params })

    // JSON Server åœ¨ headers ä¸­æä¾›åˆ†é è³‡è¨Š
    const total = parseInt(response.headers['x-total-count'] || '0')
    const page = parseInt(params?._page as string || '1')
    const limit = parseInt(params?._limit as string || '10')

    return {
      data: response.data,
      pagination: {
        page,
        limit,
        total,
        totalPages: Math.ceil(total / limit)
      }
    }
  }
}`)

const employeeServiceCode = ref(`// src/services/employee.service.ts
import { BaseApiService } from './base.service'
import type {
  Employee,
  EmployeeSearchParams,
  CreateEmployeeForm,
  UpdateEmployeeForm
} from '@/types'

export class EmployeeService extends BaseApiService {
  // 1. ç²å–å“¡å·¥åˆ—è¡¨ï¼ˆæ”¯æ´åˆ†é å’Œæœå°‹ï¼‰
  async getEmployees(params?: EmployeeSearchParams) {
    return this.getWithPagination<Employee>('/employees', params as Record<string, unknown>)
  }

  // 2. ç²å–å–®å€‹å“¡å·¥
  async getEmployee(id: number): Promise<Employee> {
    return this.get<Employee>(\`/employees/\${id}\`)
  }

  // 3. å‰µå»ºæ–°å“¡å·¥
  async createEmployee(data: CreateEmployeeForm): Promise<Employee> {
    return this.post<Employee, CreateEmployeeForm>('/employees', data)
  }

  // 4. æ›´æ–°å“¡å·¥è³‡æ–™
  async updateEmployee(data: UpdateEmployeeForm): Promise<Employee> {
    return this.put<Employee, UpdateEmployeeForm>(\`/employees/\${data.id}\`, data)
  }

  // 5. éƒ¨åˆ†æ›´æ–°å“¡å·¥
  async patchEmployee(id: number, data: Partial<Employee>): Promise<Employee> {
    return this.patch<Employee, Partial<Employee>>(\`/employees/\${id}\`, data)
  }

  // 6. åˆªé™¤å“¡å·¥
  async deleteEmployee(id: number): Promise<void> {
    return this.delete<void>(\`/employees/\${id}\`)
  }

  // 7. æœå°‹å“¡å·¥
  async searchEmployees(query: string): Promise<Employee[]> {
    return this.get<Employee[]>('/employees', { q: query })
  }

  // 8. æ ¹æ“šéƒ¨é–€ç²å–å“¡å·¥
  async getEmployeesByDepartment(departmentId: number): Promise<Employee[]> {
    return this.get<Employee[]>('/employees', { departmentId })
  }

  // 9. æ ¹æ“šç‹€æ…‹ç²å–å“¡å·¥
  async getEmployeesByStatus(status: Employee['status']): Promise<Employee[]> {
    return this.get<Employee[]>('/employees', { status })
  }

  // 10. è»Ÿåˆªé™¤å“¡å·¥ï¼ˆæ¨è–¦æ–¹å¼ï¼‰
  async terminateEmployee(id: number): Promise<Employee> {
    return this.patchEmployee(id, { status: 'terminated' })
  }

  // 11. é‡æ–°å•Ÿç”¨å“¡å·¥
  async activateEmployee(id: number): Promise<Employee> {
    return this.patchEmployee(id, { status: 'active' })
  }
}

// åŒ¯å‡ºæœå‹™å¯¦ä¾‹
export const employeeService = new EmployeeService()`)

const composableStateCode = ref(`// src/composables/useEmployees.ts
import { ref, computed } from 'vue'
import type {
  Employee,
  EmployeeSearchParams,
  CreateEmployeeForm,
  UpdateEmployeeForm,
  AppError
} from '@/types'
import { employeeService } from '@/services'

export function useEmployees() {
  // === éŸ¿æ‡‰å¼ç‹€æ…‹å®šç¾© ===
  const employees = ref<Employee[]>([])
  const currentEmployee = ref<Employee | null>(null)
  const pagination = ref({
    page: 1,
    limit: 10,
    total: 0,
    totalPages: 0
  })

  // === è¼‰å…¥ç‹€æ…‹ ===
  const employeesLoading = ref(false)
  const employeeLoading = ref(false)
  const createLoading = ref(false)
  const updateLoading = ref(false)
  const deleteLoading = ref(false)

  // === éŒ¯èª¤ç‹€æ…‹ ===
  const employeesError = ref<AppError | null>(null)
  const employeeError = ref<AppError | null>(null)
  const createError = ref<AppError | null>(null)
  const updateError = ref<AppError | null>(null)
  const deleteError = ref<AppError | null>(null)

  // === è¨ˆç®—å±¬æ€§ ===
  const activeEmployees = computed(() =>
    employees.value.filter(emp => emp.status === 'active')
  )

  const isLoading = computed(() =>
    employeesLoading.value ||
    employeeLoading.value ||
    createLoading.value ||
    updateLoading.value ||
    deleteLoading.value
  )

  const hasError = computed(() =>
    employeesError.value ||
    employeeError.value ||
    createError.value ||
    updateError.value ||
    deleteError.value
  )`)

const composableMethodsCode = ref(`  // === 1. ç²å–å“¡å·¥åˆ—è¡¨ ===
  const fetchEmployees = async (params?: EmployeeSearchParams) => {
    try {
      employeesLoading.value = true    // è¨­ç½®è¼‰å…¥ç‹€æ…‹
      employeesError.value = null      // æ¸…é™¤éŒ¯èª¤

      const result = await employeeService.getEmployees(params)
      employees.value = result.data    // æ›´æ–°å“¡å·¥åˆ—è¡¨
      pagination.value = result.pagination  // æ›´æ–°åˆ†é è³‡è¨Š
    } catch (error) {
      employeesError.value = error as AppError
    } finally {
      employeesLoading.value = false   // é‡ç½®è¼‰å…¥ç‹€æ…‹
    }
  }

  // === 2. ç²å–å–®å€‹å“¡å·¥ ===
  const fetchEmployee = async (id: number) => {
    try {
      employeeLoading.value = true
      employeeError.value = null

      const employee = await employeeService.getEmployee(id)
      currentEmployee.value = employee
      return employee
    } catch (error) {
      employeeError.value = error as AppError
      throw error  // é‡æ–°æ‹‹å‡ºéŒ¯èª¤ä¾›èª¿ç”¨è€…è™•ç†
    } finally {
      employeeLoading.value = false
    }
  }

  // === 3. å‰µå»ºå“¡å·¥ ===
  const createEmployee = async (data: CreateEmployeeForm) => {
    try {
      createLoading.value = true
      createError.value = null

      const newEmployee = await employeeService.createEmployee(data)
      employees.value.unshift(newEmployee)  // æ·»åŠ åˆ°åˆ—è¡¨é–‹é ­
      return newEmployee
    } catch (error) {
      createError.value = error as AppError
      throw error
    } finally {
      createLoading.value = false
    }
  }

  // === 4. æ›´æ–°å“¡å·¥ ===
  const updateEmployee = async (data: UpdateEmployeeForm) => {
    try {
      updateLoading.value = true
      updateError.value = null

      const updatedEmployee = await employeeService.updateEmployee(data)

      // æ›´æ–°åˆ—è¡¨ä¸­çš„å“¡å·¥è³‡æ–™
      const index = employees.value.findIndex(emp => emp.id === data.id)
      if (index !== -1) {
        employees.value[index] = updatedEmployee
      }

      // æ›´æ–°ç•¶å‰å“¡å·¥ï¼ˆå¦‚æœæ˜¯åŒä¸€å€‹ï¼‰
      if (currentEmployee.value?.id === data.id) {
        currentEmployee.value = updatedEmployee
      }

      return updatedEmployee
    } catch (error) {
      updateError.value = error as AppError
      throw error
    } finally {
      updateLoading.value = false
    }
  }

  // === 5. åˆªé™¤å“¡å·¥ ===
  const deleteEmployee = async (id: number) => {
    try {
      deleteLoading.value = true
      deleteError.value = null

      await employeeService.deleteEmployee(id)

      // å¾åˆ—è¡¨ä¸­ç§»é™¤
      employees.value = employees.value.filter(emp => emp.id !== id)

      // æ¸…é™¤ç•¶å‰å“¡å·¥ï¼ˆå¦‚æœæ˜¯åŒä¸€å€‹ï¼‰
      if (currentEmployee.value?.id === id) {
        currentEmployee.value = null
      }
    } catch (error) {
      deleteError.value = error as AppError
      throw error
    } finally {
      deleteLoading.value = false
    }
  }

  // === å›å‚³ä»‹é¢ ===
  return {
    // ç‹€æ…‹
    employees,
    currentEmployee,
    pagination,

    // è¼‰å…¥ç‹€æ…‹
    employeesLoading,
    employeeLoading,
    createLoading,
    updateLoading,
    deleteLoading,

    // éŒ¯èª¤ç‹€æ…‹
    employeesError,
    employeeError,
    createError,
    updateError,
    deleteError,

    // æ–¹æ³•
    fetchEmployees,
    fetchEmployee,
    createEmployee,
    updateEmployee,
    deleteEmployee,

    // è¨ˆç®—å±¬æ€§
    activeEmployees,
    isLoading,
    hasError
  }
}`)

const apiTestingCode = ref(`# 1. ç²å–æ‰€æœ‰å“¡å·¥
GET http://localhost:3001/api/employees

# 2. ç²å–å–®å€‹å“¡å·¥
GET http://localhost:3001/api/employees/1

# 3. å‰µå»ºå“¡å·¥
POST http://localhost:3001/api/employees
Content-Type: application/json

{
  "name": "æ¸¬è©¦å“¡å·¥",
  "email": "test@example.com",
  "phone": "0912-345-678",
  "position": "æ¸¬è©¦å·¥ç¨‹å¸«",
  "departmentId": 1,
  "salary": 50000,
  "hireDate": "2024-01-01",
  "status": "active"
}

# 4. æ›´æ–°å“¡å·¥
PUT http://localhost:3001/api/employees/1
Content-Type: application/json

{
  "id": 1,
  "name": "æ›´æ–°çš„å“¡å·¥",
  "email": "updated@example.com",
  "phone": "0912-345-678",
  "position": "é«˜ç´šå·¥ç¨‹å¸«",
  "departmentId": 1,
  "salary": 60000,
  "hireDate": "2024-01-01",
  "status": "active"
}

# 5. åˆªé™¤å“¡å·¥
DELETE http://localhost:3001/api/employees/1`)

const advancedQueryCode = ref(`# 1. å§“åæ¨¡ç³Šæœå°‹
GET http://localhost:3001/api/employees?name_like=å¼µ

# 2. è·ä½æ¨¡ç³Šæœå°‹
GET http://localhost:3001/api/employees?position_like=å·¥ç¨‹å¸«

# 3. éƒ¨é–€ç¯©é¸
GET http://localhost:3001/api/employees?departmentId=1

# 4. ç‹€æ…‹ç¯©é¸
GET http://localhost:3001/api/employees?status=active

# 5. è–ªè³‡ç¯„åœæŸ¥è©¢
GET http://localhost:3001/api/employees?salary_gte=40000&salary_lte=80000

# 6. å…¥è·æ—¥æœŸç¯„åœ
GET http://localhost:3001/api/employees?hireDate_gte=2024-01-01&hireDate_lte=2024-12-31

# 7. åˆ†é æŸ¥è©¢
GET http://localhost:3001/api/employees?_page=1&_limit=5

# 8. æ’åºæŸ¥è©¢
GET http://localhost:3001/api/employees?_sort=salary&_order=desc

# 9. è¤‡åˆæŸ¥è©¢ï¼ˆéƒ¨é–€ + ç‹€æ…‹ + åˆ†é  + æ’åºï¼‰
GET http://localhost:3001/api/employees?departmentId=1&status=active&_page=1&_limit=10&_sort=hireDate&_order=desc

# 10. å…¨æ–‡æœå°‹
GET http://localhost:3001/api/employees?q=å¼µ`)
</script>

<style scoped>
.project-integration {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

.section-intro {
    text-align: center;
    margin-bottom: 3rem;
    padding: 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
}

.section-intro h2 {
    margin: 0 0 1rem 0;
    font-size: 2.5rem;
    font-weight: 700;
}

.section-description {
    font-size: 1.125rem;
    margin: 0;
    opacity: 0.95;
}

.content-section {
    margin-bottom: 3rem;
    padding: 2rem;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.content-section h3 {
    margin: 0 0 1.5rem 0;
    font-size: 1.75rem;
    font-weight: 600;
    color: #2d3748;
    border-bottom: 3px solid #4299e1;
    padding-bottom: 0.5rem;
}

.project-overview {
    background: #f7fafc;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #4299e1;
}

.feature-list h4 {
    margin: 1.5rem 0 1rem 0;
    color: #2d3748;
    font-size: 1.25rem;
}

.feature-list ul {
    list-style: none;
    padding: 0;
}

.feature-list li {
    padding: 0.5rem 0;
    font-size: 1rem;
    color: #4a5568;
}

.step-card {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    margin-bottom: 1rem;
    border-left: 4px solid #48bb78;
}

.step-card h4 {
    margin: 0 0 1rem 0;
    color: #2d3748;
    font-size: 1.25rem;
}

.task-section {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #ed8936;
}

.task-section h4 {
    margin: 0 0 1rem 0;
    color: #2d3748;
    font-size: 1.25rem;
}

.api-testing {
    background: #f0fff4;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #38a169;
}

.troubleshooting {
    background: #fffaf0;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #ed8936;
}

.problem-section {
    margin-bottom: 1.5rem;
}

.problem-section h4 {
    margin: 0 0 1rem 0;
    color: #2d3748;
    font-size: 1.125rem;
}

.problem-section ul {
    margin: 0.5rem 0;
}

.problem-section li {
    margin: 0.5rem 0;
}

.checklist {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.checklist-section {
    background: #f7fafc;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #38a169;
}

.checklist-section h4 {
    margin: 0 0 1rem 0;
    color: #2d3748;
    font-size: 1.125rem;
}

.checkbox-list {
    list-style: none;
    padding: 0;
}

.checkbox-list li {
    padding: 0.25rem 0;
    font-size: 0.875rem;
    color: #4a5568;
}

.advanced-challenges {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.challenge-card {
    background: #edf2f7;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #805ad5;
}

.challenge-card h4 {
    margin: 0 0 1rem 0;
    color: #2d3748;
    font-size: 1.125rem;
}

.challenge-card ul {
    margin: 0;
    padding-left: 1rem;
}

.challenge-card li {
    margin: 0.25rem 0;
    font-size: 0.875rem;
    color: #4a5568;
}

.learning-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.summary-card {
    background: #f0fff4;
    padding: 1.5rem;
    border-radius: 8px;
    border-left: 4px solid #38a169;
}

.summary-card h4 {
    margin: 0 0 1rem 0;
    color: #2d3748;
    font-size: 1.125rem;
}

.summary-card ul {
    margin: 0;
    padding-left: 1rem;
}

.summary-card li {
    margin: 0.25rem 0;
    font-size: 0.875rem;
    color: #4a5568;
}

@media (max-width: 768px) {
    .project-integration {
        padding: 1rem;
    }

    .section-intro {
        padding: 1.5rem;
    }

    .section-intro h2 {
        font-size: 2rem;
    }

    .content-section {
        padding: 1.5rem;
    }

    .checklist,
    .advanced-challenges,
    .learning-summary {
        grid-template-columns: 1fr;
    }
}
</style>
